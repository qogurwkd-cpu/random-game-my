<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ì˜¤ëŠ˜ì˜ í–‰ìš´ì•„ ë½‘ê¸°</title>
<style>
  body { 
    font-family: 'Apple SD Gothic Neo', sans-serif; 
    text-align: center; 
    background-color: #f4f4f9; 
    padding: 20px; 
    margin: 0; 
  }
  h2 { color: #333; margin-bottom: 20px; }
  
  .controls { 
    background: white; padding: 15px; border-radius: 12px; 
    box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px; font-size: 16px;
  }
  input { 
    width: 50px; padding: 8px; font-size: 16px; text-align: center; 
    border: 1px solid #ccc; border-radius: 6px; margin: 0 5px;
  }
  button { 
    width: 100%; padding: 12px; font-size: 18px; font-weight: bold; 
    color: white; background-color: #28a745; border: none; 
    border-radius: 10px; cursor: pointer; margin-top: 15px;
    box-shadow: 0 4px 6px rgba(40,167,69,0.3);
  }
  button:active { background-color: #218838; transform: scale(0.98); }
  
  .lots-container { 
    display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; margin-top: 20px; 
  }
  
  .lot { 
    width: 70px; height: 100px; background-color: #007bff; 
    display: flex; align-items: center; justify-content: center; 
    font-size: 20px; font-weight: bold; border-radius: 8px; 
    box-shadow: 0 4px 8px rgba(0,0,0,0.2); 
    transition: transform 0.4s, background-color 0.4s; 
    user-select: none; color: white;
  }
  .lot .text { display: none; }
  .lot .question { display: block; font-size: 30px; }

  .lot.opened { transform: rotateY(180deg); }
  .lot.opened .text { display: block; transform: rotateY(180deg); }
  .lot.opened .question { display: none; }

  .lot.opened.win { background-color: #dc3545; }
  .lot.opened.lose { background-color: #6c757d; }
  .lot.opened.exemption { background-color: #ffc107; color: #333; } 

  .popup-container {
    display: none; 
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(0, 0, 0, 0.8); 
    z-index: 1000; justify-content: center; align-items: center; flex-direction: column;
  }
  .popup-container img {
    max-width: 85%; max-height: 85%; border-radius: 15px;
    box-shadow: 0 10px 30px rgba(255,255,255,0.3);
    animation: popUp 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
  }
  .popup-text {
    color: white; font-size: 28px; font-weight: bold; margin-top: 20px; 
    text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    animation: fadeIn 0.8s ease-in;
  }
  @keyframes popUp { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
</style>
</head>
<body>

  <h2>ì˜¤ëŠ˜ì˜ í–‰ìš´ì•„ëŠ” ëˆ„êµ¬?</h2>
  
  <div class="controls">
    <label>ì¹´ë“œ ê°œìˆ˜: <input type="number" id="total" value="10" min="2" max="30"></label> ê°œ <br><br>
    <label>ê½ ê°œìˆ˜: <input type="number" id="winCount" value="1" min="1" max="29"></label> ê°œ <br>
    <button onclick="startGame()">ìƒˆë¡œ ì„ê¸°!</button>
  </div>

  <div class="lots-container" id="lotsContainer"></div>

  <div id="imagePopup" class="popup-container">
    <img src="trappedcard.png" alt="í•¨ì •ì¹´ë“œ ì´ë¯¸ì§€">
    <div class="popup-text">í•¨ì •ì¹´ë“œ ë°œë™!</div>
  </div>

  <audio id="trapBgm" src="trappedmusic.mp3"></audio>

  <script>
    let results = [];
    const popup = document.getElementById('imagePopup'); 
    const trapBgm = document.getElementById('trapBgm'); // ì˜¤ë””ì˜¤ ê°€ì ¸ì˜¤ê¸°

    function startGame() {
      const total = parseInt(document.getElementById('total').value);
      const winCount = parseInt(document.getElementById('winCount').value);
      const container = document.getElementById('lotsContainer');
      
      if (winCount >= total) {
        alert("ê½ ê°œìˆ˜ê°€ ì¹´ë“œ ê°œìˆ˜ë³´ë‹¤ ì ì–´ì•¼ í•´!");
        return;
      }

      results = Array(total).fill('í†µê³¼');
      for (let i = 0; i < winCount; i++) {
        results[i] = 'ê½!';
      }

      if (total >= 10 && Math.random() < 0.5) {
        results[winCount] = 'í•¨ì •'; 
      }

      for (let i = results.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [results[i], results[j]] = [results[j], results[i]];
      }

      container.innerHTML = '';
      for (let i = 0; i < total; i++) {
        const lot = document.createElement('div');
        lot.className = 'lot';
        
        lot.innerHTML = `
          <span class="question">?</span>
          <span class="text">${results[i]}</span>
        `;
        
        lot.onclick = function() {
          if (this.classList.contains('opened')) return; 
          
          this.classList.add('opened');
          
          if (results[i] === 'ê½!') {
            this.classList.add('win');
          } else if (results[i] === 'í•¨ì •') { 
            this.classList.add('exemption');
            popup.style.display = 'flex'; 
            
            // ğŸµ í•¨ì • ì¹´ë“œ ì—´ ë•Œ BGM ì¬ìƒ!
            trapBgm.currentTime = 0; // ì¬ìƒ ìœ„ì¹˜ë¥¼ ì²˜ìŒ(0ì´ˆ)ìœ¼ë¡œ
            trapBgm.play(); 
          } else {
            this.classList.add('lose');
          }
        };
        
        container.appendChild(lot);
      }
    }

    // íŒì—… ë‹«ì„ ë•Œ ìŒì•…ë„ ê°™ì´ ë„ê¸°
    popup.onclick = function() {
      this.style.display = 'none';
      trapBgm.pause(); // ìŒì•… ì •ì§€
      trapBgm.currentTime = 0; // ë‹¤ìŒë²ˆì„ ìœ„í•´ ì²˜ìŒìœ¼ë¡œ ë˜ëŒë ¤ë†“ê¸°
    };

    startGame();
  </script>
</body>
</html>